package ais

import "testing"

/* Check mitigation of https://github.com/BertoldVdb/go-ais/pull/11#issuecomment-2242987393 */
func TestPanicFastDecodeBinaryMessage(t *testing.T) {
	corpus := []string{
		"01101010101101001011101100111010111101111101011010100101101001111101100101111101110001010101110",
		"01101010010000010101011101111011001011111000110001110000010111100000011101010101101110011000011101011100",
		"011010100101010100101010011110110111011001001011100110110101100110001101010100010010101001",
		"01100100011000100001010001000111100000111100011110000101110010100101000",
		"011001110111011101011000010000110000111000011110010111100110",
	}

	cd := CodecNewFast(true, true, true)

	for _, m := range corpus {
		pkt := []byte(m)
		for i := range m {
			pkt[i] -= '0'
		}
		if result := cd.DecodePacket(pkt); result != nil {
			t.Error("Managed to decode invalid packet", result.GetHeader())
		}
	}
}
